% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/SimFunctions.R
\name{Sim-Functions}
\alias{Sim-Functions}
\alias{sim}
\title{Merger Simulation With User-Supplied Demand Parameters}
\usage{
sim(
  prices,
  shares,
  supply = c("bertrand", "cournot", "auction", "bargaining", "bargaining2nd"),
  demand = c("Linear", "AIDS", "LogLin", "Logit", "CES", "LogitNests", "CESNests",
    "LogitCap", "BLP"),
  demand.param,
  ownerPre,
  ownerPost,
  nests,
  capacities,
  mcDelta = rep(0, length(prices)),
  subset = rep(TRUE, length(prices)),
  insideSize = 1,
  priceOutside,
  priceStart,
  bargpowerPre = rep(0.5, length(prices)),
  bargpowerPost = bargpowerPre,
  labels = paste("Prod", 1:length(prices), sep = ""),
  ...
)
}
\arguments{
\item{prices}{A length k vector of product prices.}

\item{shares}{A length k vector of product shares. Only used for \sQuote{BLP} demand. See Details.}

\item{supply}{A character string indicating how firms compete with one another. Valid
values are "bertrand" (Nash Bertrand), "cournot" (Nash Cournot), "auction2nd"
(2nd score auction), "bargaining", or "bargaining2nd".}

\item{demand}{A character string indicating the type of demand system
to be used in the merger simulation. Supported demand systems are
linear (\sQuote{Linear}), log-linear(\sQuote{LogLin}), logit (\sQuote{Logit}), nested logit
(\sQuote{LogitNests}), ces (\sQuote{CES}), nested CES (\sQuote{CESNests}) and capacity
constrained Logit (\sQuote{LogitCap}).}

\item{demand.param}{See Below.}

\item{ownerPre}{EITHER a vector of length k whose values
indicate which firm produced a product pre-merger OR
a k x k matrix of pre-merger ownership shares.}

\item{ownerPost}{EITHER a vector of length k whose values
indicate which firm produced a product after the merger OR
a k x k matrix of post-merger ownership shares.}

\item{nests}{A length k vector identifying the nest that each
product belongs to. Must be supplied when \sQuote{demand} equals \sQuote{CESNests} and
\sQuote{LogitNests}.}

\item{capacities}{A length k vector of product capacities. Must be
supplied when \sQuote{demand} equals \sQuote{LogitCap}.}

\item{mcDelta}{A vector of length k where each element equals the
proportional change in a product's marginal costs due to
the merger. Default is 0, which assumes that the merger does not
affect any products' marginal cost.}

\item{subset}{A vector of length k where each element equals TRUE if
the product indexed by that element should be included in the
post-merger simulation and FALSE if it should be excluded.Default is a
length k vector of TRUE.}

\item{insideSize}{A length 1 vector equal to total units sold if \sQuote{demand} equals "logit", or total revenues if
\sQuote{demand} equals "ces".}

\item{priceOutside}{A length 1 vector indicating the price of the
outside good. This option only applies to the \sQuote{Logit} class and its child classes
Default for \sQuote{Logit},\sQuote{LogitNests}, and \sQuote{LogitCap} is 0,
and for \sQuote{CES} and \sQuote{CesNests} is 1.}

\item{priceStart}{A length k vector of starting values used to solve for
equilibrium price. Default is the \sQuote{prices} vector for all values of
demand except for \sQuote{AIDS}, which is set equal to a vector of 0s.}

\item{bargpowerPre}{A length k vector of pre-merger bargaining power parameters. Values
must be between 0 (sellers have the power) and 1 (buyers the power). Ignored if \sQuote{supply} not equal
to "bargaining" or bargaining2nd.}

\item{bargpowerPost}{A length k vector of post-merger bargaining power parameters. Values
must be between 0 (sellers have the power) and 1 (buyers the power). Default is \sQuote{bargpowerPre}.
Ignored if \sQuote{supply} not equal to "bargaining".}

\item{labels}{A k-length vector of labels. Default is \dQuote{Prod#}, where
\sQuote{#} is a number between 1 and the length of \sQuote{prices}.}

\item{...}{Additional options to feed to the
optimizer used to solve for equilibrium prices.}
}
\value{
\code{sim} returns an instance of the class specified by the
\sQuote{demand} argument.
}
\description{
Simulates the price effects of a merger between two firms
with user-supplied demand parameters under the
assumption that all firms in the market are playing either a
differentiated products Bertrand pricing game, Cournot quantity game,
2nd price (score) auction, or bargaining game.

Let k denote the number of products produced by all firms below.
}
\details{
Using user-supplied demand parameters,
\code{sim} simulates the effects of a merger in a market where
firms are playing a differentiated products pricing game.

The \sQuote{supply} parameter determines the type of competition.
When \sQuote{supply} equals \sQuote{cournot}, firms compete on quantities
rather than prices. Cournot competition is supported for \sQuote{Logit}
and \sQuote{BLP} demand systems, creating \code{LogitCournot} and
\code{CournotBLP} class objects respectively.

If \sQuote{demand} equals \sQuote{Linear}, \sQuote{LogLin}, or
\sQuote{AIDS}, then \sQuote{demand.param} must be a
list containing:
\describe{
  \item{slopes}{A k x k matrix of slope coefficients.}
  \item{intercepts}{A length-k vector of intercepts.}
}
Additionally, if \sQuote{demand} equals \sQuote{AIDS},
\sQuote{demand.param} must also contain:
\describe{
  \item{mktElast}{An estimate of aggregate market elasticity.}
}
For \sQuote{Linear} demand models, \code{sim} returns an error if
any intercepts are negative. For \sQuote{Linear}, \sQuote{LogLin},
and \sQuote{AIDS} models, \code{sim} returns an error if not all
diagonal elements of the slopes matrix are negative.

If \sQuote{demand} equals \sQuote{Logit} or \sQuote{LogitNests}, then
\sQuote{demand.param} must equal a list containing:
\describe{
  \item{alpha}{The price coefficient.}
  \item{meanval}{A length-k vector of mean valuations. If none of the
  values of \sQuote{meanval} are zero, an outside good is assumed to exist.}
}

If \sQuote{demand} equals \sQuote{BLP}, then
\sQuote{demand.param} must equal a list containing:
\describe{
  \item{alpha}{The mean price coefficient (or use alphaMean).}
  \item{meanval}{A length-k vector of mean valuations. If none of the
  values of \sQuote{meanval} are zero, an outside good is assumed to exist.
  If \sQuote{meanval} is not provided, then \sQuote{shares} must be supplied
  so that mean valuations can be recovered via BLP contraction mapping.}
  \item{sigma}{The standard deviation of the random coefficient on price,
  representing consumer heterogeneity in price sensitivity.}
  \item{sigmaNest}{Optional nesting parameter for the outside good: sigmaNest in (0,1]
  where sigmaNest=1 is flat logit (no nesting) and sigmaNest->0 means products are
  perfect substitutes within the nest. Default is 1.}
  \item{piDemog}{Optional vector of demographic coefficients for the price coefficient.
  Each element represents the interaction effect of a demographic variable with price.}
  \item{nDemog}{Number of demographic variables. Required if piDemog is provided. Default is 0.}
  \item{nDraws}{Number of draws to use for simulating consumer heterogeneity. Default is 1000.}
}

Note: The \sQuote{shares} argument is only used with \sQuote{BLP} demand.
If supplied for any other demand system, a warning will be issued but the function will proceed
(shares will be ignored). For \sQuote{BLP},
either \sQuote{meanval} must be provided in \sQuote{demand.param} OR \sQuote{shares}
must be supplied to the \code{sim} function to perform BLP contraction mapping.

If \sQuote{demand} equals \sQuote{CES} or \sQuote{CESNests}, then
\sQuote{demand.param} must equal a list containing:
\describe{
  \item{gamma}{The price coefficient.}
  \item{alpha}{The coefficient on the numeraire good. May instead be
  calibrated using \sQuote{shareInside}.}
  \item{meanval}{A length-k vector of mean valuations. If none of the
  values of \sQuote{meanval} are zero, an outside good is assumed to exist.}
  \item{shareInside}{The budget share of all products in the
  market. Default is 1, meaning that all consumer wealth is spent on
  products in the market. May instead be specified using \sQuote{alpha}.}
}
}
\examples{
## Calibration and simulation results from a merger between Budweiser and
## Old Style. Note that the in the following model there is no outside
## good; BUD's mean value has been normalized to zero.

## Source: Epstein/Rubenfeld 2004, pg 80


prodNames <- c("BUD", "OLD STYLE", "MILLER", "MILLER-LITE", "OTHER-LITE", "OTHER-REG")
ownerPre <- c("BUD", "OLD STYLE", "MILLER", "MILLER", "OTHER-LITE", "OTHER-REG")
ownerPost <- c("BUD", "BUD", "MILLER", "MILLER", "OTHER-LITE", "OTHER-REG")
nests <- c("Reg", "Reg", "Reg", "Light", "Light", "Reg")

price <- c(.0441, .0328, .0409, .0396, .0387, .0497)

demand.param <- list(
  alpha = -48.0457,
  meanval = c(0, 0.4149233, 1.1899885, 0.8252482, 0.1460183, 1.4865730)
)

sim.logit <- sim(price,
  supply = "bertrand", demand = "Logit", demand.param,
  ownerPre = ownerPre, ownerPost = ownerPost
)


print(sim.logit) # return predicted price change
summary(sim.logit) # summarize merger simulation

elast(sim.logit, TRUE) # returns premerger elasticities
elast(sim.logit, FALSE) # returns postmerger elasticities

diversion(sim.logit, TRUE) # return premerger diversion ratios
diversion(sim.logit, FALSE) # return postmerger diversion ratios


cmcr(sim.logit) # calculate compensating marginal cost reduction
upp(sim.logit) # calculate Upwards Pricing Pressure Index

CV(sim.logit) # calculate representative agent compensating variation

\dontrun{
## Philadelphia National Bank Example: Comparing Four Model Types
## Demonstrates Logit, Cournot, LogitBLP, and CournotBLP

# Philadelphia National Bank data (38 products)
prices <- c(
  2.46, 2.21, 2.4, 2.29, 2.05, 2.45, 1.13, 2.39, 2.66, 2.73,
  1.83, 1.84, 2.76, 2.46, 1.1, 2.53, 2.27, 2.31, 2.72, 1.96, 2.26,
  2.63, 2.07, 2.31, 1.33, 2.67, 2.68, 2.59, 2.62, 1.85, 2.63, 1.51,
  1.8, 2.66, 1.4, 2.39, 2.35, 1.82
)

shares <- c(
  0.12499, 0.11462, 0.07748, 0.05231, 0.05168, 0.02918, 0.01622,
  0.01245, 0.00992, 0.00578, 0.00461, 0.00417, 0.00415, 0.00275,
  0.00271, 0.00214, 0.00206, 0.00184, 0.00176, 0.00155, 0.00151,
  0.00146, 0.00146, 0.00103, 0.00101, 0.00095, 8e-04, 0.00066,
  0.00062, 0.00061, 0.00057, 0.00053, 0.00053, 5e-04, 0.00049,
  0.00048, 0.00041, 0.00039
)

ownerPre <- diag(38)
ownerPost <- diag(38)
ownerPost[2, 3] <- 1 # Products 2 and 3 merge
ownerPost[3, 2] <- 1

insideSize <- 4773473000

# Logit parameters (from calibrated model)
logit_params <- list(
  alpha = 0.4296,
  meanval = c(
    -2.265, -2.206, -2.671, -2.972, -2.855, -3.596, -3.494, -4.344,
    -4.709, -5.253, -4.966, -5.059, -5.572, -5.773, -5.128, -6.043,
    -5.933, -6.057, -6.339, -6.027, -6.215, -6.46, -6.146, -6.597,
    -6.131, -6.871, -7.035, -7.169, -7.237, -6.833, -7.318, -6.804,
    -6.939, -7.457, -6.819, -7.328, -7.473, -7.227
  )
)

# BLP parameters
blp_params <- list(
  alpha = 1.0,
  sigma = 0.3,
  sigmaNest = 0.9,
  nDraws = 200
)

# MODEL 1: Logit (Bertrand)
result_logit <- sim(prices,
  supply = "bertrand", demand = "Logit",
  demand.param = logit_params, ownerPre = ownerPre,
  ownerPost = ownerPost, insideSize = insideSize
)
summary(result_logit)

# MODEL 2: Logit (Cournot)
result_cournot <- sim(prices,
  supply = "cournot", demand = "Logit",
  demand.param = logit_params, ownerPre = ownerPre,
  ownerPost = ownerPost, insideSize = insideSize
)
summary(result_cournot)

# MODEL 3: LogitBLP (Bertrand with random coefficients)
result_logitblp <- sim(prices, shares,
  supply = "bertrand", demand = "BLP",
  demand.param = blp_params, ownerPre = ownerPre,
  ownerPost = ownerPost, insideSize = insideSize
)
summary(result_logitblp)

# MODEL 4: CournotBLP (Cournot with random coefficients)
result_cournotblp <- sim(prices, shares,
  supply = "cournot", demand = "BLP",
  demand.param = blp_params, ownerPre = ownerPre,
  ownerPost = ownerPost, insideSize = insideSize
)
summary(result_cournotblp)
}

}
\seealso{
The S4 class documentation for: \code{\linkS4class{Linear}},
\code{\linkS4class{AIDS}}, \code{\linkS4class{LogLin}}, \code{\linkS4class{Logit}},
\code{\linkS4class{LogitNests}}, \code{\linkS4class{CES}}, \code{\linkS4class{CESNests}}
}
\author{
Charles Taragin \email{ctaragin+antitrustr@gmail.com}
}
